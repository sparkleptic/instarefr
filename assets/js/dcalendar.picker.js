if("undefined"==typeof jQuery)throw new Error("DCalendar.Picker: This plugin requires jQuery");+function(a){Date.prototype.getDays=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],e=function(c,d){function g(a){var b=new Date(f.date),c=b.getMonth(),d=b.getFullYear();b.setDate(1),"days"===f.viewMode?b.setMonth(c+("next"===a?1:-1)):b.setFullYear(d+("next"===a?1:-1)),f.date=b,f.create(f.viewMode)}if(this.calendar=a(c),this.today=new Date,""===this.calendar.prev().val())this.date=new Date;else{var e=this.reformatDate(this.calendar.prev().val());this.date=isNaN(parseInt(e.m))?new Date(e.m+" "+e.d+", "+e.y):new Date(e.y,e.m-1,e.d)}this.viewMode="days",this.options=d,this.selected=this.date.getMonth()+1+"/"+this.date.getDate()+"/"+this.date.getFullYear(),this.minDate=this.calendar.prev().data("mindate"),this.maxDate=this.calendar.prev().data("maxdate"),"calendar"===d.mode?this.tHead=a('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>'):"datepicker"===d.mode&&(this.tHead=a('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),this.tHead.find("#currM").text(b[this.today.getMonth()]+" "+this.today.getFullYear()),this.calendar.prepend(this.tHead);var f=this;this.calendar.on("click","#next",function(){g("next")}).on("click","#prev",function(){g("prev")}).on("click","#today",function(){f.viewMode="days";var a=new Date(f.date),b=new Date(f.today);a.toString()!=b.toString()&&(f.date=b),f.create("days")}).on("click",".date, .pMDate, .nMDate",function(){var b=a(this).hasClass("pMDate"),c=a(this).hasClass("nMDate"),d=a(this).text(),e=f.date.getMonth(),g=f.date.getFullYear(),h="today"===f.minDate?new Date(f.today.getFullYear(),f.today.getMonth(),f.today.getDate()):new Date(f.minDate),i="today"===f.maxDate?new Date(f.today.getFullYear(),f.today.getMonth(),f.today.getDate()):new Date(f.maxDate);b?g=0===e?g-1:g:c&&(g=e+2===13?g+1:g),b?e=0===e?"12":e:c?e=e+2===13?"1":e+2:e+=1;var j=new Date(g,e-1,d);if(!(f.minDate&&j<h||f.maxDate&&j>i))return f.selected=e+"/"+d+"/"+g,"datepicker"===f.options.mode&&(f.calendar.find("td").removeClass("selected"),a(this).addClass("selected")),f.selectDate(),!0}).on("click","#currM",function(){f.viewMode="months",f.create(f.viewMode)}).on("click",".month",function(b){f.viewMode="days";var c=new Date(f.date);f.calendar.find("#currM").text();c.setMonth(a(b.currentTarget).attr("num")),f.date=c,f.create(f.viewMode)}),this.create(this.viewMode)};e.prototype={constructor:e,setDate:function(){var a=this,b=a.reformatDate(a.calendar.prev().val()),c=isNaN(parseInt(b.m))?new Date(b.m+" "+b.d+", "+b.y):new Date(b.y,b.m-1,b.d);a.selected=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),a.selectDate(),a.date=c,a.create(a.viewMode)},selectDate:function(){var b=this,c=b.formatDate(b.options.format),d=a.Event("selectdate",{date:c});b.calendar.trigger(d)},reformatDate:function(a){var b=this,c=b.options.format;return{m:a.substring(c.indexOf("m"),c.lastIndexOf("m")+1),d:a.substring(c.indexOf("d"),c.lastIndexOf("d")+1),y:a.substring(c.indexOf("y"),c.lastIndexOf("y")+1)}},formatDate:function(a){var d=this,e=new Date(d.selected),f=e.getDate(),g=e.getMonth(),h=e.getFullYear();return a.replace(/(yyyy|yy|mmmm|mmm|mm|m|dd|d)/gi,function(a){switch(a.toLowerCase()){case"d":return f;case"dd":return f<10?"0"+f:f;case"m":return g+1;case"mm":return g+1<10?"0"+(g+1):g+1;case"mmm":return c[g];case"mmmm":return b[g];case"yy":return h.toString().substr(2,2);case"yyyy":return h}})},create:function(e){var f=this,g=[],h=a("<tbody></tbody>"),i=new Date(f.date.getFullYear(),f.date.getMonth(),f.date.getDate()),j=f.date.getDays(),k=1,l=1,m=f.selected.split("/"),n=new Date(m[2],m[0]-1,m[1]),o=new Date(f.today.getFullYear(),f.today.getMonth(),f.today.getDate()),p="today"===f.minDate?o:new Date(f.minDate),q="today"===f.maxDate?o:new Date(f.maxDate);if(f.calendar.empty(),"days"===e){"calendar"===f.options.mode?f.tHead=a('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>'):"datepicker"===f.options.mode&&(f.tHead=a('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),f.tHead.find("#currM").text(b[f.date.getMonth()]+" "+f.date.getFullYear()),f.calendar.append(f.tHead);for(var r=1;r<=6;r++){for(var s=[a("<td></td>"),a("<td></td>"),a("<td></td>"),a("<td></td>"),a("<td></td>"),a("<td></td>"),a("<td></td>")];k<=j;){i.setDate(k);var t=i.getDay();if(i.getTime()==o.getTime()&&s[t].attr("id","currDay"),(f.minDate&&i<p||f.maxDate&&i>q)&&s[t].addClass("disabled"),"datepicker"===f.options.mode&&i.getTime()==n.getTime()&&s[t].addClass("selected"),1===r&&0===t)break;if(!(t<6)){s[t].html("<span>"+k++ +"</span>").addClass("date");break}s[t].html("<span>"+k++ +"</span>").addClass("date")}if(1===r||r>4)if(1===r)for(var u=new Date(f.date.getFullYear(),f.date.getMonth()-1,1),w=(u.getMonth(),u.getDays()),x=6;x>=0;x--)""===s[x].text()&&(u.setDate(w),s[x].html("<span>"+w--+"</span>").addClass("pMDate"),(f.minDate&&u<p||f.maxDate&&u>q)&&s[x].addClass("disabled"),"datepicker"===f.options.mode&&u.getTime()==n.getTime()&&s[x].addClass("selected"));else if(r>4)for(var y=new Date(f.date.getFullYear(),f.date.getMonth()+1,1),x=0;x<=6;x++)""===s[x].text()&&(y.setDate(l),s[x].html("<span>"+l++ +"</span>").addClass("nMDate"),(f.minDate&&y<p||f.maxDate&&y>q)&&s[x].addClass("disabled"),"datepicker"===f.options.mode&&y.getTime()==n.getTime()&&s[x].addClass("selected"));g.push(s)}a.each(g,function(b,c){for(var d=a("<tr></tr>"),e=c.length,b=0;b<e;b++)d.append(c[b]);h.append(d)});var z="Today: "+d[f.today.getDay()]+", "+b[f.today.getMonth()]+" "+f.today.getDate()+", "+f.today.getFullYear();h.append('<tr><td colspan="7" id="today">'+z+"</td></tr>").appendTo(f.calendar)}else{this.tHead=a('<thead><tr><th id="prev">&lsaquo;</th><th colspan="2" id="currM"></th><th id="next">&rsaquo;</th></tr>'),f.tHead.find("#currM").text(f.date.getFullYear()),f.tHead.appendTo(f.calendar);for(var A=0,r=0;r<3;r++){for(var B=a("<tr></tr>"),C=0;C<4;C++){var D=a('<td align="center"></td>'),E=a('<span class="month" num="'+A+'">'+c[A]+"</span>");D.append(E).appendTo(B),A++}h.append(B)}var z="Today: "+d[f.today.getDay()]+", "+b[f.today.getMonth()]+" "+f.today.getDate()+", "+f.today.getFullYear();h.append('<tr><td colspan="4" id="today">'+z+"</td></tr>").appendTo(f.calendar)}}},a.fn.dcalendar=function(b){return a(this).each(function(c,d){var f=this,g=a(f),h=a(f).data("dcalendar"),i=a.extend({},a.fn.dcalendar.defaults,g.data(),"object"==typeof b&&b);h||g.data("dcalendar",h=new e(this,i)),"string"==typeof b&&h[b]()})},a.fn.dcalendar.defaults={mode:"calendar",format:"mm/dd/yyyy"},a.fn.dcalendar.Constructor=e,a.fn.dcalendarpicker=function(b){return a(this).each(function(){var c=a(this),d=!1,e=!1,f=null;if("string"==typeof b){var g=c.next(".calendar").data("dcalendar");g[b]()}else f=a('<table class="calendar"></table>'),c.wrap(a('<div class="datepicker" style="display:inline-block;position:relative;"></div>')),f.css({position:"absolute",left:0,display:"none","box-shadow":"0 4px 6px 1px rgba(0, 0, 0, 0.14)",width:"230px"}).appendTo(c.parent()),b?(b.mode="datepicker",f.dcalendar(b)):f.dcalendar({mode:"datepicker"}),f.hover(function(){d=!0},function(){d=!1}).on("click",function(){e?(e=!1,a(this).hide()):c.focus()}).on("selectdate",function(b){c.val(b.date).trigger("onchange"),c.trigger(a.Event("dateselected",{date:b.date,elem:c})),e=!0}),c.on("keydown",function(a){if(a.which)return!1}).on("focus",function(){a(".datepicker").find(".calendar").not(f).hide(),f.show()}).on("blur",function(){d||f.hide()})})}}(jQuery);